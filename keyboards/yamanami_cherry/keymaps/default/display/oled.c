// Copyright 2023 QMK
// SPDX-License-Identifier: GPL-2.0-or-later

#include "oled.h"
#include "layers.h"

#ifdef OLED_ENABLE

static void render_logo(void) {
    static const unsigned char PROGMEM raw_logo[] = {
        // 'logo_and_text', 128x32px
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xc0, 0x30, 0x0c, 0x02, 0x03, 0x02, 0x0c, 0x30,
        0xc0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x1c, 0x70, 0xc0, 0x00, 0xc0, 0x70, 0x1c, 0x00, 0x00, 0x40, 0x40, 0x40,
        0x40, 0x40, 0x40, 0xc0, 0x00, 0x00, 0xe0, 0x80, 0x40, 0x40, 0xc0, 0x40, 0x40, 0x40, 0xc0, 0x00,
        0x00, 0x40, 0x40, 0x40, 0x40, 0x40, 0x40, 0xc0, 0x00, 0x00, 0xe0, 0x80, 0x40, 0x40, 0x40, 0xc0,
        0x00, 0x00, 0x40, 0x40, 0x40, 0x40, 0x40, 0x40, 0xc0, 0x00, 0x00, 0xe0, 0x80, 0x40, 0x40, 0xc0,
        0x40, 0x40, 0x40, 0xc0, 0x00, 0x00, 0xcc, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xc0, 0x30, 0x0c, 0x06, 0x0c, 0x30, 0xc0,
        0x00, 0x00, 0x00, 0x00, 0xc0, 0x30, 0x0c, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x03, 0x0c, 0x30, 0xc0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x7f, 0x01, 0x00, 0x00, 0x00, 0x00, 0x3c, 0x42, 0x42,
        0x42, 0x42, 0x42, 0x3f, 0x00, 0x00, 0x7f, 0x00, 0x00, 0x00, 0x7f, 0x00, 0x00, 0x00, 0x7f, 0x00,
        0x00, 0x3c, 0x42, 0x42, 0x42, 0x42, 0x42, 0x3f, 0x00, 0x00, 0x7f, 0x00, 0x00, 0x00, 0x00, 0x7f,
        0x00, 0x00, 0x3c, 0x42, 0x42, 0x42, 0x42, 0x42, 0x3f, 0x00, 0x00, 0x7f, 0x00, 0x00, 0x00, 0x7f,
        0x00, 0x00, 0x00, 0x7f, 0x00, 0x00, 0x7f, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0xc0, 0x30, 0x0c, 0x03, 0x00, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x03, 0x0c, 0xb0, 0xce, 0xe1, 0xf0, 0xf8, 0xfc, 0xfe, 0xfc, 0xf8, 0xf0, 0xe0, 0xc0, 0x80, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x80, 0x03, 0x0c, 0x30, 0xc0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0xfc, 0x00, 0x80, 0x40, 0x20, 0x10, 0x08, 0x00, 0x00, 0x00, 0x80, 0x80,
        0x80, 0x80, 0x80, 0x80, 0x00, 0x00, 0x00, 0x60, 0x80, 0x00, 0x00, 0x00, 0x80, 0x60, 0x00, 0x00,
        0x00, 0xfc, 0x80, 0x40, 0x40, 0x40, 0x80, 0x00, 0x00, 0x00, 0x00, 0xc0, 0x20, 0x20, 0x20, 0x20,
        0xc0, 0x00, 0x00, 0x00, 0x00, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0xe0, 0x00, 0x00, 0x00, 0xe0,
        0x00, 0x80, 0x40, 0x80, 0x00, 0x00, 0x00, 0x80, 0x40, 0x40, 0x40, 0x80, 0xfc, 0x00, 0x00, 0x00,
        0x40, 0x60, 0x70, 0x78, 0x76, 0x71, 0x78, 0x7c, 0x7e, 0x7f, 0x7f, 0x7f, 0x7e, 0x7c, 0x78, 0x7c,
        0x7e, 0x7f, 0x7f, 0x7f, 0x7f, 0x7f, 0x7f, 0x7f, 0x7f, 0x7f, 0x7f, 0x7f, 0x7f, 0x7f, 0x7f, 0x7f,
        0x7e, 0x7c, 0x7e, 0x7f, 0x7f, 0x7f, 0x7e, 0x7c, 0x78, 0x73, 0x7c, 0x78, 0x70, 0x60, 0x40, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x3f, 0x01, 0x02, 0x04, 0x08, 0x10, 0x20, 0x00, 0x00, 0x1f, 0x24, 0x24,
        0x24, 0x24, 0x24, 0x24, 0x13, 0x00, 0x00, 0x00, 0x41, 0x46, 0x78, 0x06, 0x01, 0x00, 0x00, 0x00,
        0x00, 0x3f, 0x10, 0x20, 0x20, 0x20, 0x10, 0x0f, 0x00, 0x00, 0x07, 0x18, 0x20, 0x20, 0x20, 0x20,
        0x18, 0x07, 0x00, 0x00, 0x00, 0x1e, 0x21, 0x21, 0x21, 0x21, 0x21, 0x1f, 0x00, 0x00, 0x00, 0x3f,
        0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0f, 0x10, 0x20, 0x20, 0x20, 0x10, 0x3f, 0x00, 0x00, 0x00
    };
    oled_write_raw_P((const char *)raw_logo, sizeof(raw_logo));
}

oled_rotation_t oled_init_user(oled_rotation_t rotation) {
    oled_clear();
    if (is_keyboard_master()) {
        return OLED_ROTATION_0;
    } else {
        return OLED_ROTATION_0;
    }
}

bool oled_task_user(void) {
    if (!is_keyboard_left()) {
        render_logo();
    } else {
        oled_clear();
        char *data = "";
        switch (isCurrentLayer) {
            // QWERTY レイヤーの処理
            case _QWERTY_US_US:
                // 現在のレイヤーを表示する
                data = "Default layer\n- Keycap: US\n- OS Layout: US";
                break;
            case _QWERTY_US_JIS:
                data = "Default layer\n- Keycap: US\n- OS Layout: JIS";
                break;
            case _QWERTY_JIS_US:
                data = "Default layer\n- Keycap: JIS\n- OS Layout: US";
                break;
            case _QWERTY_JIS_JIS:
                data = "Default layer\n- Keycap: JIS\n- OS Layout: JIS";
                break;
            // LOWER レイヤーの処理
            case _LOWER_US_US:
                data = "Default layer\n- Keycap: US\n- OS Layout: US\nMomentary LOWER";
                break;
            case _LOWER_US_JIS:
                data = "Default layer\n- Keycap: US\n- OS Layout: JIS\nMomentary LOWER";
                break;
            case _LOWER_JIS_US:
                data = "Default layer\n- Keycap: JIS\n- OS Layout: US\nMomentary LOWER";
                break;
            case _LOWER_JIS_JIS:
                data = "Default layer\n- Keycap: JIS\n- OS Layout: JIS\nMomentary LOWER";
                break;
            // RAISE レイヤーの処理
            case _RAISE_US_US:
                data = "Default layer\n- Keycap: US\n- OS Layout: US\nMomentary RAISE";
                break;
            case _RAISE_US_JIS:
                data = "Default layer\n- Keycap: US\n- OS Layout: JIS\nMomentary RAISE";
                break;
            case _RAISE_JIS_US:
                data = "Default layer\n- Keycap: JIS\n- OS Layout: US\nMomentary RAISE";
                break;
            case _RAISE_JIS_JIS:
                data = "Default layer\n- Keycap: JIS\n- OS Layout: JIS\nMomentary RAISE";
                break;
            // ADJUST レイヤーの処理
            case _ADJUST_US_US:
                data = "Default layer\n- Keycap: US\n- OS Layout: US\nMomentary ADJUST";
                break;
            case _ADJUST_US_JIS:
                data = "Default layer\n- Keycap: US\n- OS Layout: JIS\nMomentary ADJUST";
                break;
            case _ADJUST_JIS_US:
                data = "Default layer\n- Keycap: JIS\n- OS Layout: US\nMomentary ADJUST";
                break;
            case _ADJUST_JIS_JIS:
                data = "Default layer\n- Keycap: JIS\n- OS Layout: JIS\nMomentary ADJUST";
                break;
        }
        oled_write_ln_P(data, false);
        if (keymap_config.swap_lalt_lgui && keymap_config.swap_control_capslock) {
            oled_write_ln_P(
                PSTR("Alt<->Win ctrl<->caps"),
                false
            );
        } else if (keymap_config.swap_lalt_lgui && !keymap_config.swap_control_capslock) {
            oled_write_ln_P(
                PSTR("Alt<->Win"),
                false
            );
        } else if (!keymap_config.swap_lalt_lgui && keymap_config.swap_control_capslock) {
            oled_write_ln_P(
                PSTR("ctrl<->caps"),
                false
            );
        }
    }
    return false;
}

#endif // OLED_ENABLE
